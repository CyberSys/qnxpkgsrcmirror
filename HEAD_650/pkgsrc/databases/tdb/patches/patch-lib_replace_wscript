$NetBSD$

--- lib/replace/wscript.orig	2012-04-11 12:36:35.000000000 +0000
+++ lib/replace/wscript
@@ -202,10 +202,10 @@ def configure(conf):
                         define_ret = True,
                         define = 'HAVE_BSD_STRTOLL',
                         )
-    conf.CHECK_FUNCS('if_nametoindex strerror_r')
+    conf.CHECK_FUNCS_IN('if_nametoindex strerror_r', 'socket', checklibc=True)
     conf.CHECK_FUNCS('getdirentries getdents syslog')
-    conf.CHECK_FUNCS('gai_strerror get_current_dir_name')
-    conf.CHECK_FUNCS('timegm getifaddrs freeifaddrs mmap setgroups setsid')
+    conf.CHECK_FUNCS_IN('gai_strerror get_current_dir_name', 'socket', checklibc=True)
+    conf.CHECK_FUNCS_IN('timegm getifaddrs freeifaddrs mmap setgroups setsid', 'socket', checklibc=True)
     conf.CHECK_FUNCS('getgrent_r getgrgid_r getgrnam_r getgrouplist getpagesize')
     conf.CHECK_FUNCS('getpwent_r getpwnam_r getpwuid_r epoll_create')
 
@@ -241,7 +241,7 @@ def configure(conf):
     # these headers need to be tested as a group on freebsd
     conf.CHECK_HEADERS(headers='sys/socket.h net/if.h', together=True)
     conf.CHECK_HEADERS(headers='netinet/in.h arpa/nameser.h resolv.h', together=True)
-    conf.CHECK_FUNCS_IN('res_search', 'resolv', checklibc=True,
+    conf.CHECK_FUNCS_IN('res_search', 'socket resolv', checklibc=True,
                         headers='netinet/in.h arpa/nameser.h resolv.h')
 
 
@@ -439,6 +439,7 @@ def build(bld):
     REPLACE_HOSTCC_SOURCE = ''
 
     if bld.CONFIG_SET('REPLACE_STRPTIME'):       REPLACE_HOSTCC_SOURCE += ' strptime.c'
+    if not bld.CONFIG_SET('HAVE_C99_VSNPRINTF'):       REPLACE_HOSTCC_SOURCE += ' snprintf.c'
     for filename, functions in REPLACEMENT_FUNCTIONS.iteritems():
         for function in functions:
             if not bld.CONFIG_SET('HAVE_%s' % function.upper()):
